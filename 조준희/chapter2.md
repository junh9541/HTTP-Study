# Chapter 2

## URL과 리소스

> 들어가며

도시에서 지번을 통해 주소를 표시하듯이 인터넷도 리소스의 주소를 표시하기 위한 표준 프로토콜이 존재한다.  
우리는 URL를 통해 리소스의 위치와 접근 방법을 알 수 있다.

챕터 2는 다음의 내용을 다룬다.

- URL 문법, 각 요소의 의미와 역할
- 단축 URL: 상대 URL과 확장 URL
- URL 인코딩, 문자 규칙
- 공통 URL 스킴
- URN, URL의 미래

> URL을 통한 리소스 탐색

사용자가 URL을 입력하면 브라우저는 URL이 가리키는 리소스를 얻기 위해 적절한 프로토콜을 사용해 메세지를 전송한다.

```
http://www.joes-gardware.com/seasonal/index-fall.html
```

- 스킴  
  :클라이언트가 URL에 접근하기 위한 프로토콜 명시 ("http:")
- 서버 위치  
  : IP 혹은 도메인 이름이 명시된다. 리소스 호스팅 위치를 알려준다.("www.joes-gardware.com")
- 리소스 경로  
  : 서버의 로컬 리소스 중 요청받은 리소스를 식별한다.("/seasonal/index-fall.html")

```
스킴://서버위치/경로
```

인터넷의 모든 리소스는 위의 일관된 URL 구조로 지칭된다.

### URL 문법

URL은 스킴, 호스트(서버 위치), 경로를 기본으로 구성되며, 이 외에도 다양한 컴포넌트로 구성될 수 있다.

> 스킴: 사용할 프로토콜

스킴은 리소스에 접근하는 프로토콜 정보를 알려준다.  
알파벳으로 시작하며 ":"로 구분된다.  
대소문자를 구분하지 않는다.

> 호스트와 포트

호스트와 포트는 서버의 위치를 특정한다.

**호스트**  
리소스를 호스팅하고 있는 장비의 위치를 가리킨다.  
호스트명 혹은 IP 주소로 표현된다.  
호스트명은 DNS 서버를 통해 IP 주소로 변환된다.

**포트**  
서버가 열려있는 네트워크 포트를 가리킨다.  
URL에서 생략되어 있다면 기본 포트 80으로 간주된다.

> 사용자 이름과 비밀번호

서버의 데이터에 접근하기 위해 사용자 이름과 비밀번호가 요구될 때 필요한 컴포넌트다.

사용자 이름-비밀번호 파트와 다른 컴포넌트는 "@"로 구분된다.  
사용자 이름과 비밀번호는 ":"로 구분된다.

**사용자 이름**  
사용자 이름이 입력되지 않았다면 브라우저 마다 가진 기본값이 사용된다.

> 경로

경로 컴포넌트는 서버에서의 리소스 위치를 표시한다.  
계층적 파일 시스템 경로와 유사한 구조다.  
"/"를 기준으로 나뉘며 각 경로조각은 자체만의 파라미터 컴포넌트를 가질 수 있다.

> 파라미터

파라미터 컴포넌트를 통해 정확한 요청을 위한 입력 파라미터를 받는다.

이름/값 쌍의 리스트 형태다.  
 ";"로 나머지 컴포넌트와 구분된다.

경로 조각이 파라미터를 가질 떄는 다음과 같이 표시된다.

```
http://www.joes.com/hammers;sale=false/index.html;graphics=true
```

위 URL에서 hammer 경로 조각은 sale=false 파라미터를 가진다.  
index.html 경로 조각은 graphics=true 파라미터를 가진다.

> 질의 문자열

질의 문자열은 요청받을 리소스 형식의 범위를 좁힌다.

질의 문자열은 "?"로 시작한다.  
"이름=값" 쌍 형식이다.  
각 쌍은 "&"로 구분된다.

```
http://www.joes.com/inventory.cgi?item=12731
```

위 URL은 질의 문자열을 통해 수 많은 물품 중 12731번 물품의 데이터를 특정해서 찾는다.

> 프래그먼트

URL이 리소스 전체가 아닌, 리소스 일부만을 가리킬 떄 프래그먼트 컴포넌트를 통해 리소스의 일부분을 가리킨다.

프래그먼트는 "#"로 시작한다.

HTTP는 리소스 객체 전체만을 다룬다.  
브라우저가 서버로부터 리소스 전체를 받은 후, 사용자에게 일부분만 표시할 때 프래그먼트가 사용된다.

### 단축 URL

단축 URL의 종류로 상대 URL과 확장 URL이 있다.  
**상대 URL** 을 통해 리소스를 간결하게 기술한다.  
**확장 URL** 을 통해 URL 일부만 입력해 나머지를 자동으로 입력할 수 있다.

> 상대 URL

상대 URL은 절대 URL과 다르게 리소스를 가리키기 위한 모든 정보가 있지 않다.  
베이스 URL을 기반으로 하여, 상대적인 URL을 통해 리소스 위치를 가리킨다.

HTML에서 상대 URL은 HTML 문서 URL을 기반으로 한다.

```
http://www.joes.com/tolls.html
./hammers.html
```

위 URL의 HTML 문서에서 아래의 상대 URL이 사용되었다면, 위 URL을 베이스 URL로 사용하여 아래의 절대 URL로 변환할 수 있다.

```
http://www.joes.com/hammers.html
```

상대 주소를 사용하여 문서 집합의 위치를 변경하더라도 새로운 베이스 URL을 통해 절대 URL로 변환되기에 위치 변경이 편리해진다.

기저 URL(베이스 URl)은 다음과 같은 방법으로 알 수 있다.

- **리소스에서 명시적 제공**  
  : HTML 문서에서 \<BASE> 태그를 통해 기저 URL을 표시하는 등 명확하게 기술한다.
- **리소스를 포함하는 기저 URL**  
  :상대 URL이 리소스에 포함되었지만 기저 URl이 명시되어있지 않다면, 리소스의 URL을 기저 URL로 사용한다.
- **기저 URL이 없는 경우**  
  :기저 URl이 없다면 절대 URl이다. 혹은 불완전하거나 깨진 URl일 수 있다.

> 상대 URL 절대 URL로 변환

> URL 확장

URL 확장 기능은 URl일부의 입력만으로 자동으로 URL을 확장하는 기능이다.

URL 확장은 호스트명 확장과 히스토리 확장으로 나뉜다.

**호스트명 확장**  
호스트명 일부만 입력해도 간단한 유추를 통해 전체 호스트명을 완성한다.  
"yahho" 입력만으로 "www.yahoo.com"이 완성되는 식이다.

**히스토리 확장**  
과거 사용자가 방문한 URL 기록을 저장하여  
URL 일부만 입력해도 그 앞글자를 포함하는 과거의 URL을 선택할 수 있다.

호스트명 확장은 프락시와 같은 다른 HTTP 애플리케이션에 문제를 발생시킬 수 있다.  
프락시를 이용한다면 자동 확장 기능이 다르게 동작할 수 있다. (6장 다룸)

### 안전하지 않은 문자 다루기

인터넷 상의 리소스들은 여러 프로토콜을 이용해 전송된다.  
URL은 여려 프로토콜을 통한 전송에 모두 호환되도록 설계되었다.

여러 프로토콜을 사용하던 정보 유실 없이 안전한 전송을 보장하는 것은 중요하다.

URL은 가독성을 보장하며 전송 중 정보가 소실을 막기 위해 안전한 알파벳 문자만 포함하도록 한다.

그러나 URL에 이진 데이터, 알파벳 외의 문자를 포함할 필요성이 생겼다.  
이에 추가된 "이스케이프" 기능은 안전하지 않은 문자를 안전한 문자로 인코딩한다.

> URL 문자 집합

기본적으로 컴퓨터 시스템의 기반 문자 집합은 영어 중심이다.  
수많은 컴퓨터 애플리케이션이 사용하는 문자 집합인 US-ASCII 또한 그렇다.  
US-ASCII는 7비트를 사용해 대다수 영문 자판 키와 몇몇 제어문자를 표현한다.

적은 문자를 포함하기에 비영어권 문자는 US-ASCII로 지원하지 못한다.  
URL에 이진데이터를 포함해야 할 필요성 또한 있다.

위 문제를 해결하기 위해 이스케이프 문자열이 추가되었다.

> 인코딩 체계

안전하지 않은 문자는 "%"로 시작해 ASCII 코드로 표현되는 두 개의 16진수 숫자로 이루어진 이스케이프 문자로 바꾼다.
문자|ASCII 코드|URL 내
|--|--|--
~|126(0x7E)|%7E
빈 문자|32(0x20)|%20

> 문자 제한

특정 문자들은 US-ASCII로 출력 불가능하거나 다른 목적으로 선점된 문자로, 인코딩이 반드시 필요하다.

| 문자                | 선점 및 제한                                                  |
| ------------------- | ------------------------------------------------------------- |
| %                   | 인코딩된 문자의 이스케이프 토큰으로 선점                      |
| /                   | 경로 세그먼트 구분 용도로 선점                                |
| .                   | 경로 컴포넌트에서 선점                                        |
| ..                  | 경로 컴포넌트에서 선점                                        |
| \#                  | 프래그먼트 구획 문자로 선점                                   |
| ?                   | 질의 문자열 구획 문자로 선점                                  |
| ;                   | 파라미터 구획 문자로 선점                                     |
| :                   | 스킴, 사용자이름/비밀번호, 호스트/포트 구획 문자로 선점       |
| $, +                | 선점                                                          |
| @ & =               | 특정 스킴에서 특별한 의미로 선점                              |
| { } \| \\ · ~ [ ] ` | 게이트웨이 등 전송 에이전트에서 불안전하게 다뤄 제한됨        |
| <>"                 | URL 범위 밖에서 역할이 있기에 불안전해 제한됨                 |
| 0x00-0x1F, 0x7F     | 이 16진수 범위의 문자는 인쇄되지 않는 US-ASCII 문자로 제한됨  |
| \> 0x7F             | 이 16진수 범위의 문자는 7비트 US-ASCII 문자가 아님으로 제한됨 |

> 더 알아보기

인코딩이 필수적인 문자라도 프로토콜에 따라 문제가 없지만, 규정에 따라 인코딩 하는 것이 바람직하다.

문자 인코딩은 브라우저와 같이 사용자에게서 URL을 입력받는 애플리케이션에서 수행한다.

모든 문자를 인코딩 하는 것은 완벽하고 빠르지만, 애플리케이션의 인코딩 방식에 따라 오작동의 가능성이 있어 추천되지 않는다.

악의적인 사용자가 이미 안전한 URL 컴포넌트를 인코딩하면 패턴 매칭 애플리케이션 패턴을 찾기 어려울 수 있다.  
따라서 URl을 해석하는 애플리케이션은 URL 처리 전 디코딩을 거쳐야 한다.

## 스킴 포맷

## 미래의 URI

URL은 프로토콜 상관 없이 인터넷 상의 모든 객체에 일관적으로 이름을 지을 수 있다.

그러나 리소스의 위치가 옮겨지면 그 URL은 사용할 수 없다.

URN은 URL의 한계를 극복하기 위해 고안되었다. URN은 웹 서버 내에서, 혹은 웹 서버 간에서 객체가 이동하더라도 항상 그 객체를 가리킨다.

지속 통합 자원 지시자(PURL)을 사용하면 URL로 URN 의 기능을 제공할 수 있다.  
실제 URL 목록을 관리하는 리소스 위치 중개 서버가 클라이언트에세 영구적인 URL을 제공하고, 중개 서버를 통해 실제 URL로 연결되는 방식이다.

표준 주소 체계를 바꾸는 것은 거대한 작업이다.  
URN으로의 체계 변화는 표준 제정 HTTP 어플리케이션 수정 등 엄청난 작업량이 필요하다.  
현재, 그리고 가까운 미래에는 여전히 URL로 리소스를 명명하는 방식이 사용될 것이다.
